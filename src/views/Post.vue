<template>
  <div class="contanier" style="padding-top:0.1em;">
    <div class="main">
      <article class="main-inner">
        <mymarkdown :is="root"></mymarkdown>
        <div style="display: flex;justify-content: space-between;padding-top: 20px;">
          <!-- 左右切换按钮 -->
          <el-button icon="el-icon-caret-left" @click="lastpost" circle></el-button>
          <el-button icon="el-icon-caret-right" @click="nextpost" circle></el-button>
          <!-- 左右切换按钮 -->
        </div>
      </article>
    </div>
    <FootInner></FootInner>

    <el-backtop type="text"></el-backtop>
  </div>
</template>
<script>
import FootInner from "@/components/FootInner.vue";
import { bloglist, techlen, lifelist, lifelen } from "@/bloglist";
import mediumZoom from "medium-zoom";

// 代码高亮
import hljs from "highlight.js";
import $ from "jquery";
import "highlight.js/styles/tomorrow-night-eighties.css";
const highlightCode = () => {
  const preEl = document.querySelectorAll("pre code");

  preEl.forEach(el => {
    hljs.highlightBlock(el);
  });
};


//批量注册

  const context = require.context("@/assets/tech", true, /\.md$/);
const lifetext = require.context("@/assets/life", true, /\.md$/);
const moduleStore = {
  FootInner
};
context.keys().forEach(key => {
  const fileName = key.split(".")[1].split("/")[1];
  const fileModule = context(key).default;
  moduleStore[fileName] = {
    ...fileModule,
    namespaced: true
  };
});
lifetext.keys().forEach(key => {
  const fileName = key.split(".")[1].split("/")[1];
  const fileModule = lifetext(key).default;
  moduleStore[fileName] = {
    ...fileModule,
    namespaced: true
  };
});



export default {
  
  components: moduleStore,


  mounted() {
    highlightCode();
    mediumZoom(document.querySelectorAll("p img"));
    $("pre code").each(function() {
      $(this).html(
        "<ul><li>" +
          $(this)
            .html()
            .replace(/\n/g, "</li><li>") +
          "\n</li></ul>"
      );
    });
  },
  updated() {
    highlightCode();
    mediumZoom(document.querySelectorAll("p img"));
    $("pre code").each(function() {
      $(this).html(
        "<ul><li>" +
          $(this)
            .html()
            .replace(/\n/g, "</li><li>") +
          "\n</li></ul>"
      );
    });
  },
  created() {
    if (this.list == "tech") {
      for(var i in bloglist){
        if (bloglist[i].content==this.root){
          this.index=i
        }
      }
    }else{ for( i in lifelist){
        if (lifelist[i].content==this.root){
          this.index=i
        }
      }}

  },
  methods: {
    // 上一篇文章
    nextpost() {
      if (this.list == "tech") {
        if (this.index < this.techlen - 1) {
          ++this.index;
          if (this.index < this.techlen) {
            this.root = bloglist[this.index].content;
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
          }
        } else {
          this.$notify.info({
            title: "贴心提示",
            message: "再点也没有了🍭"
          });
        }
      } else {
        if (this.index < this.lifelen - 1) {
          ++this.index;
          if (this.index < this.lifelen) {
            this.root = lifelist[this.index].content;
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
          }
        } else {
          this.$notify.info({
            title: "贴心提示",
            message: "再点也没有了🍭"
          });
        }
      }
    },
    // 下一篇文章
    lastpost() {
      if (this.list == "tech"){
        if (this.index > 0) {
          --this.index;
          this.root = bloglist[this.index].content;
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
        } else {
        this.$notify.info({
          title: "贴心提示",
          message: "前面没有了🍬"
        });
      }
      }else{
        if (this.index > 0) {
          --this.index;
          this.root = lifelist[this.index].content;
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
        }else {
        this.$notify.info({
          title: "贴心提示",
          message: "前面没有了🍬"
        });
      }
      }
      
    }
  },
  data() {
    return {
      // 用来切换组件的数据
      root: this.$route.params.name,
      list: this.$route.params.list,
      // 文章的序列号
      index: "",
      // 最大文章的序列号
      bloglist,
      lifelist,
      lifelen,
      techlen
    };
  }
};
</script>
<style lang="less" scoped>
.main {
  padding: 2em 1em;
  overflow-wrap: break-word;
  word-wrap: break-word;
}

.main-inner {
  text-align: justify;
  width: 36em;
  margin: 0 auto;
  font-size: 16px;
  line-height: 1.618;
  @media (max-width: 38em) {
    width: auto;
  }
}
.el-button {
  border: 0px solid white;
}
</style>